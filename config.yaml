project:
  name: "beach_inverts_zooscan"          # only used for bookkeeping / naming

  raw_dir: "data/raw_scans"              # input ZooScan TIFFs
  background_tif: "data/backgrounds/20251103_1208_background_large_manual.tif"  # flat-field / background image
  work_dir: "data/work"                  # preprocessed full scans (background corrected)

  raw_rois_dir: "data/raw_rois"          # ROIs from first segmentation (unmasked)
  clean_rois_dir: "data/cleaned_rois"    # ROIs after masking / cleanup

  tables_dir: "data/tables"              # all EcoTaxa-style tables (raw + *_clean.tsv)

  metadata_tsv: "metadata/YUFE_gravel_meta.tsv"  # sample info (must contain sample_id)


segmentation:
  gaussian_sigma: 0.5          # smoothing before thresholding
  min_area: 220                # px; filters out very small particles
  max_area: 1000000            # px; safety upper bound
  dilate_radius: 2             # px; keeps thin bits (antennae) connected
  open_radius: 1               # px; breaks tiny bridges / nonsense connections
  thresh_mode: "hybrid"        # global_otsu / local_mean / hybrid
  local_window: 151            # px; odd
  local_offset: 0.0            # intensity offset for local threshold
  margin: 40                   # base margin in px around each object
  margin_factor: 0.6          # extra margin ~ factor * sqrt(area); larger for big beasts
  min_contrast: 300.0          # contrast filter (p95 - p5); raise to kill flat junk



cleanup:
  sigma: 0.15                             # smoothing (px) used only for building ROI mask
  min_area: 50                           # min area (px) for candidate components inside ROI
  margin: 25                             # padding (px) around main object inside ROI
  mask_background: true
  mask_dilate_radius: 8                 # extra dilation (px) of mask to keep hairs / antenna tips
  mask_feather_sigma: 3.5                # Gaussian feathering of mask edge (px); higher = softer edge
  bg_percentile: 99.999                    # background level = this percentile of ROI intensities (higher = whiter bg)
  tone_mode: "gamma"
  gamma: 0.7

